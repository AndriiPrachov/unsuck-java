CREATE TABLE CUSTOMER (
    ID BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    FIRST_NAME VARCHAR NOT NULL,
    LAST_NAME VARCHAR NOT NULL,
    COUNTRY_OF_RESIDENCE CHAR(2) NOT NULL,
    DATE_OF_BIRTH DATE NOT NULL,
    EMAIL VARCHAR NOT NULL UNIQUE
);

CREATE TABLE BANK_APPLICATION (
    ID BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    APPLICANT_FIRST_NAME VARCHAR NOT NULL,
    APPLICANT_LAST_NAME VARCHAR NOT NULL,
    APPLICANT_COUNTRY_OF_RESIDENCE CHAR(2) NOT NULL,
    APPLICANT_DATE_OF_BIRTH DATE NOT NULL,
    APPLICANT_EMAIL VARCHAR NOT NULL UNIQUE,
    SERVICES TEXT ARRAY,
    SUBMISSION_DATE TIMESTAMP NOT NULL
);

CREATE TABLE BANK_ACCOUNT (
    ID BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    IBAN VARCHAR(35) NOT NULL,
    STATUS VARCHAR(25) NOT NULL,
    DAILY_LIMIT DECIMAL(13, 2) NOT NULL,
    MONTHLY_LIMIT DECIMAL(13, 2) NOT NULL,
    HOLDER_ID BIGINT,
    FOREIGN KEY (HOLDER_ID) REFERENCES CUSTOMER (ID)
);

CREATE TABLE BANK_ACCOUNT_TX (
    BANK_ACCOUNT_ID BIGINT REFERENCES BANK_ACCOUNT(ID) DEFERRABLE INITIALLY DEFERRED,
    INDEX INTEGER GENERATED ALWAYS AS IDENTITY,
    AMOUNT DECIMAL(13, 2) NOT NULL,
    BOOKING_TIME TIMESTAMP NOT NULL,
    TYPE VARCHAR(25) NOT NULL,
    PRIMARY KEY(BANK_ACCOUNT_ID, INDEX)
);

CREATE TABLE SCHEDULED_COMMAND (
    ID BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    CREATION_DATE TIMESTAMP NOT NULL,
    COMMAND VARCHAR NOT NULL
);